# STM32 温度监测系统

![STM32](https://img.shields.io/badge/STM32-F103ZET6-blue.svg)
![C](https://img.shields.io/badge/language-C-orange.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)

基于正点原子 STM32F103ZET6 开发板的智能温度监测系统，具备实时数据采集、OLED 显示、蓝牙控制、智能报警等功能。本项目为嘉庚学院实践周课程设计作品。

## 🌟 系统特性

- **实时温度监测**：使用 DS18B20 传感器持续采集温度数据
- **OLED 显示**：0.96 寸 OLED 屏幕显示温度、日期、时间及系统状态
- **蓝牙控制**：通过 HC-05/HC-06 蓝牙模块无线配置参数
- **历史数据记录**：每日温度极值记录，包含发生时间戳
- **智能报警系统**：可配置温度阈值，联动蜂鸣器和风扇
- **分时段监测**：通过蓝牙设置监测时间段
- **多界面显示**：实时数据、历史记录、蓝牙设置、参数显示四种模式

## 🛠️ 硬件需求

### 核心组件

- **主控芯片**：STM32F103ZET6（正点原子精英板）
- **温度传感器**：DS18B20 防水温度传感器
- **显示模块**：0.96 寸 OLED I2C 显示屏（SSD1306 驱动）
- **时钟模块**：DS1302 实时时钟（带电池备份）
- **蓝牙模块**：HC-05 或 HC-06 蓝牙串口模块

### 控制组件

- **散热风扇**：5V 直流风扇（PWM 调速控制）
- **报警蜂鸣器**：有源蜂鸣器
- **控制按键**：板载按键（KEY0/KEY1/KEY_UP）
- **电源系统**：USB 供电或外部 5V 电源

### 正点原子 ZET6 引脚连接表

```
正点原子STM32F103ZET6引脚分配：
├── DS18B20（温度传感器）
│   ├── VCC → 3.3V（板载3.3V输出）
│   ├── GND → GND（任意GND引脚）
│   ├── DQ → PC5（单总线，可换其他GPIO）
├── DS1302（实时时钟）
│   ├── VCC → 3.3V
│   ├── GND → GND
│   ├── SCL → PA4（时钟线）
│   ├── SDA → PA5（数据线）
│   ├── RST → PA6（复位线）
├── OLED显示屏（I2C接口）
│   ├── VCC → 3.3V
│   ├── GND → GND
│   ├── SCL → PB10（I2C2_SCL）
│   ├── SDA → PB11（I2C2_SDA）
├── 蓝牙模块
│   ├── VCC → 3.3V
│   ├── GND → GND
│   ├── TXD → PA3（USART2_RX）
│   ├── RXD → PA2（USART2_TX）
├── 风扇控制
│   ├── VCC → 5V（板载5V输出）
│   ├── GND → GND
│   ├── PWM → PB5（TIM3_CH2）
├── 蜂鸣器
│   ├── VCC → 3.3V
│   ├── GND → GND
│   ├── CTRL → PB8（板载蜂鸣器）
├── 按键输入
│   ├── KEY0 → PE4（板载KEY0，解除报警）
│   ├── KEY1 → PE3（板载KEY1，界面切换）
│   └── KEY_UP → PA0（板载WK_UP，备用）
```

## 📁 项目结构

```
STM32-Temperature-Monitor/
├── Core/
│   ├── Inc/                    # 头文件
│   │   ├── main.h             # 主程序头文件
│   │   ├── gpio.h             # GPIO配置
│   │   ├── tim.h              # 定时器配置
│   │   ├── usart.h            # 串口配置
│   │   └── stm32f1xx_hal_conf.h # HAL库配置
│   └── Src/                   # 源文件
│       ├── main.c             # 主程序（含完整业务逻辑）
│       ├── ds18b20.c/.h       # DS18B20温度传感器驱动
│       ├── ds1302.c/.h        # DS1302实时时钟驱动
│       ├── oled.c/.h          # OLED显示屏驱动
│       ├── hal_iic.c/.h       # I2C通信协议实现
│       ├── delay_us.c/.h      # 微秒级延时函数
│       ├── gpio.c             # GPIO初始化
│       ├── tim.c              # 定时器配置
│       └── usart.c            # 串口配置
├── Drivers/                   # STM32 HAL库
├── MDK-ARM/                   # Keil工程文件
├── FinalProject.ioc           # STM32CubeMX工程文件
└── README.md                  # 项目说明文档
```

## 🚀 快速开始

### 1. 硬件准备

按照引脚连接表完成硬件连接，确保所有模块供电正常。

### 2. 软件环境

- **开发环境**：Keil uVision5 或 STM32CubeIDE
- **编译器**：ARM GCC 或 ARMCC
- **烧录工具**：ST-Link Utility 或 STM32CubeProgrammer
- **串口工具**：SSCOM、XCOM 等串口调试助手

### 3. 编译烧录

1. 使用 STM32CubeMX 打开`FinalProject.ioc`文件
2. 生成代码后，用 Keil 打开`MDK-ARM/FinalProject.uvprojx`
3. 编译工程（快捷键：F7）
4. 连接 ST-Link，下载程序（快捷键：F8）

### 4. 系统测试

- **上电自检**：OLED 显示"温度监测系统"和当前时间
- **温度测试**：用手触摸 DS18B20 传感器，观察温度变化
- **蓝牙测试**：用手机蓝牙串口 APP 连接，发送测试指令

## 📱 操作说明

### 显示界面切换

系统共有 4 个显示界面，通过 KEY1 按键循环切换：

1. **实时数据界面**（默认）

   - 显示：系统标题、当前日期时间、实时温度
   - 温度格式：":XX.X°C"

2. **历史记录界面**

   - 显示：当日日期、最高温度及时间、最低温度及时间
   - 格式："H:XX.XC HH:MM"、"L:XX.XC HH:MM"

3. **蓝牙设置界面**

   - 显示：蓝牙图标、接收到的指令、执行结果
   - 支持实时调试和参数配置

4. **参数设置界面**
   - 显示：监测开始时间、监测结束时间、温度报警阈值

### 蓝牙指令格式

通过蓝牙串口发送以下指令进行配置：

#### 设置温度阈值

```
格式：tempXX.X
示例：temp30.5（设置阈值为30.5°C）
响应：TEMP SET:30.5
```

#### 设置监测时间段

```
格式：HHMMHHMM（开始小时分钟+结束小时分钟）
示例：09301830（9:30-18:30）
响应：TIME SET:09:30:00-18:30:00
```

#### 错误处理

```
无效指令响应：ERR:INVALID CMD
```

### 报警功能

- **自动报警**：温度超过阈值时，蜂鸣器响起，风扇启动
- **手动解除**：按 KEY0 按键可暂时关闭蜂鸣器
- **智能恢复**：温度降至阈值以下时，自动解除报警

## 🔧 技术细节

### 温度采集

- **传感器**：DS18B20 单总线数字温度传感器
- **精度**：±0.5°C（-10°C 到+85°C 范围）
- **分辨率**：0.1°C
- **采样频率**：5Hz（每 200ms 采样一次）

### 时钟系统

- **RTC 芯片**：DS1302 低功耗实时时钟
- **时间格式**：24 小时制
- **日期范围**：2000-2099 年
- **备用电池**：CR2032 纽扣电池

### 显示系统

- **OLED 规格**：128×64 像素，0.96 寸
- **驱动芯片**：SSD1306
- **接口类型**：I2C（400kHz）
- **显示内容**：中文、英文、数字混合显示

### 控制算法

- **温度控制**：三段式控制策略

  - <阈值-1°C：关闭风扇和蜂鸣器
  - 阈值-1°C~阈值：启动风扇，关闭蜂鸣器
  - ≥ 阈值：启动风扇和蜂鸣器

- **状态管理**：使用状态机确保设备响应及时
- **防抖动**：按键消抖处理（50ms 延时）

## 📝 开发说明

### 代码架构

- **模块化设计**：各功能模块独立，便于维护
- **中断驱动**：按键和蓝牙通信使用中断方式
- **低功耗**：空闲时进入低功耗模式
- **错误处理**：完善的错误检测和处理机制

### 扩展建议

- **数据存储**：增加 EEPROM 存储历史数据
- **无线传输**：添加 WiFi 模块实现远程监控
- **手机 APP**：开发配套手机应用程序
- **多路采集**：支持多个温度传感器同时监测

## 🐛 常见问题

### Q1: OLED 不显示

- 检查 I2C 连接是否正确
- 确认 OLED 模块供电 3.3V
- 检查 I2C 地址（默认 0x78）

### Q2: 温度读取异常

- 确认 DS18B20 接线正确
- 检查上拉电阻（4.7kΩ）
- 验证传感器是否损坏

### Q3: 蓝牙无法连接

- 确认蓝牙模块波特率 9600
- 检查 TX/RX 是否交叉连接
- 验证蓝牙模块工作状态

### Q4: 时间不准

- 检查 DS1302 晶振（32.768kHz）
- 确认备用电池电压
- 重新校准时间

## 📄 许可证

本项目采用 MIT 许可证，详见[LICENSE](LICENSE)文件。

## 👥 作者信息

- **项目名称**：STM32 温度监测系统
- **学校**：嘉庚学院
- **用途**：实践周课程设计
- **开发时间**：2025 年

## 🙏 致谢

- 感谢嘉庚学院提供的学习平台
- 感谢 STM32 社区的技术支持
- 感谢开源硬件项目的贡献

---

如有问题或建议，欢迎提交 Issue 或 Pull Request！
